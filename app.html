<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RFL Crystals MiniApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    section { display: none; }
    section.active { display: block; }
  </style>
</head>
<body class="bg-black text-white min-h-screen pb-20">

  <!-- User Info -->
  <div class="text-center py-6">
    <img id="avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä" class="w-20 h-20 rounded-full mx-auto border-2 border-blue-500" />
    <div id="username" class="text-xl mt-2 font-semibold"></div>
    <div id="balance" class="text-lg text-blue-400 mt-1"></div>
  </div>

  <!-- –ì–ª–∞–≤–Ω–∞—è -->
  <section id="home" class="active px-4">
    <button id="buyCrystalsBtn" class="w-full py-3 bg-blue-600 rounded-2xl mb-4 hover:bg-blue-700 transition">–ö—É–ø–∏—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</button>
    <button id="inviteFriendBtn" class="w-full py-3 bg-green-600 rounded-2xl hover:bg-green-700 transition">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>
  </section>

  <!-- –ö–µ–π—Å—ã -->
  <section id="cases" class="px-4">
    <h2 class="text-2xl font-bold mb-4">–ö–µ–π—Å—ã</h2>
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-zinc-800 p-4 rounded-2xl shadow text-center">
        <h3 class="font-semibold">Rusty Case</h3>
        <p class="text-blue-300">500 üíé</p>
      </div>
      <div class="bg-zinc-800 p-4 rounded-2xl shadow text-center">
        <h3 class="font-semibold">Tactical Case</h3>
        <p class="text-blue-300">3000 üíé</p>
      </div>
    </div>
  </section>

  <!-- –î—Ä—É–∑—å—è -->
  <section id="friends" class="px-4">
    <h2 class="text-2xl font-bold mb-4">–î—Ä—É–∑—å—è</h2>
    <ul id="friendsList" class="space-y-2"></ul>
  </section>

  <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
  <section id="profile" class="px-4">
    <h2 class="text-2xl font-bold mb-4">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="bg-zinc-800 p-4 rounded-2xl">
      <p id="profileName" class="mb-2"></p>
      <p id="profileBalance"></p>
    </div>
  </section>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="fixed bottom-0 w-full bg-zinc-900 py-3 flex justify-around text-sm text-gray-400">
    <button class="nav-btn active flex flex-col items-center" data-target="home">üè†<span>–ì–ª–∞–≤–Ω–∞—è</span></button>
    <button class="nav-btn flex flex-col items-center" data-target="cases">üì¶<span>–ö–µ–π—Å—ã</span></button>
    <button class="nav-btn flex flex-col items-center" data-target="friends">üë•<span>–î—Ä—É–∑—å—è</span></button>
    <button class="nav-btn flex flex-col items-center" data-target="profile">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç -->
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const navButtons = document.querySelectorAll(".nav-btn");
    const sections = document.querySelectorAll("section");

    navButtons.forEach(btn => {
      btn.onclick = () => {
        navButtons.forEach(b => b.classList.remove("text-blue-400", "active"));
        btn.classList.add("text-blue-400", "active");

        sections.forEach(s => s.classList.remove("active"));
        document.getElementById(btn.dataset.target).classList.add("active");
      };
    });

    async function loadUserData() {
      try {
        const userId = tg.initDataUnsafe.user?.id || 123;
        const res = await fetch(`https://24cs2case.ru/api/user/${userId}`);
        if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞");
        const user = await res.json();

        document.getElementById("avatar").src = user.avatar || "https://via.placeholder.com/80";
        document.getElementById("username").textContent = user.name;
        document.getElementById("balance").textContent = `–ë–∞–ª–∞–Ω—Å: ${user.balance} üíé`;

        document.getElementById("profileName").textContent = `–ò–º—è: ${user.name}`;
        document.getElementById("profileBalance").textContent = `–ë–∞–ª–∞–Ω—Å: ${user.balance} üíé`;

        const friendsList = document.getElementById("friendsList");
        friendsList.innerHTML = "";
        user.friends.forEach(friend => {
          const li = document.createElement("li");
          li.className = "bg-zinc-800 p-2 rounded-xl";
          li.textContent = friend.name;
          friendsList.appendChild(li);
        });
      } catch (err) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.");
        console.error(err);
      }
    }

    loadUserData();
  </script>

</body>
</html>
