<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RFL Crystals MiniApp</title>
  <style>
    body { background-color: #000; color: #fff; font-family: Arial, sans-serif; }
    #avatar { width: 80px; height: 80px; border-radius: 50%; margin: 20px auto; display: block; }
    #username { text-align: center; font-size: 24px; margin-top: 10px; }
    #balance { font-size: 20px; margin: 20px; text-align: center; }
    .nav { display: flex; justify-content: space-around; background: #111; padding: 10px 0; position: fixed; bottom: 0; width: 100%; }
    .nav button { background: none; border: none; color: #aaa; font-size: 16px; }
    .nav button.active { color: #39f; font-weight: bold; }
    section { display: none; padding-bottom: 50px; }
    section.active { display: block; }
  </style>
</head>
<body>
  <img id="avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä" />
  <div id="username"></div>
  <div id="balance"></div>

  <section id="home" class="active">
    <button id="buyCrystalsBtn">–ö—É–ø–∏—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</button><br><br>
    <button id="inviteFriendBtn">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>
  </section>

  <section id="cases">
    <h2>–ö–µ–π—Å—ã</h2>
    <p>–ó–¥–µ—Å—å —Å–ø–∏—Å–æ–∫ –∫–µ–π—Å–æ–≤ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)</p>
  </section>

  <section id="friends">
    <h2>–î—Ä—É–∑—å—è</h2>
    <ul id="friendsList"></ul>
  </section>

  <section id="profile">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <p id="profileName"></p>
    <p id="profileBalance"></p>
  </section>

  <div class="nav">
    <button class="nav-btn active" data-target="home">–ì–ª–∞–≤–Ω–∞—è</button>
    <button class="nav-btn" data-target="cases">–ö–µ–π—Å—ã</button>
    <button class="nav-btn" data-target="friends">–î—Ä—É–∑—å—è</button>
    <button class="nav-btn" data-target="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;

    const navButtons = document.querySelectorAll(".nav-btn");
    const sections = document.querySelectorAll("section");
    navButtons.forEach(btn => {
      btn.onclick = () => {
        navButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        sections.forEach(s => s.classList.remove("active"));
        document.getElementById(btn.dataset.target).classList.add("active");
      };
    });

    async function loadUserData() {
      const userId = tg.initDataUnsafe.user.id;
      const res = await fetch(`http://localhost:8000/api/user/${userId}`);
      const user = await res.json();

      document.getElementById("avatar").src = user.avatar;
      document.getElementById("username").textContent = user.name;
      document.getElementById("balance").textContent = `–ë–∞–ª–∞–Ω—Å: ${user.balance} üíé`;

      document.getElementById("profileName").textContent = `–ò–º—è: ${user.name}`;
      document.getElementById("profileBalance").textContent = `–ë–∞–ª–∞–Ω—Å: ${user.balance} üíé`;

      const friendsList = document.getElementById("friendsList");
      friendsList.innerHTML = "";
      user.friends.forEach(friend => {
        const li = document.createElement("li");
        li.textContent = friend.name;
        friendsList.appendChild(li);
      });
    }

    loadUserData();
  </script>
</body>
</html>
